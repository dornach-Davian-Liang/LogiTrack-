# LogiTrack Pro - 前端功能需求文档

> **版本**: v1.0  
> **日期**: 2026-01-28  
> **状态**: 待审核  
> **基于**: schema_v2.sql 数据库设计

---

## 目录

1. [系统概述](#1-系统概述)
2. [用户角色与权限](#2-用户角色与权限)
3. [功能模块设计](#3-功能模块设计)
   - 3.1 [登录模块](#31-登录模块)
   - 3.2 [Dashboard 仪表盘](#32-dashboard-仪表盘)
   - 3.3 [询价管理模块](#33-询价管理模块)
   - 3.4 [报价管理模块](#34-报价管理模块)
   - 3.5 [主数据管理模块](#35-主数据管理模块)
   - 3.6 [统计报表模块](#36-统计报表模块)
4. [核心交互逻辑](#4-核心交互逻辑)
5. [字段级详细设计](#5-字段级详细设计)
6. [API 接口需求](#6-api-接口需求)
7. [UI/UX 设计原则](#7-uiux-设计原则)
8. [待确认事项](#8-待确认事项)

---

## 1. 系统概述

### 1.1 系统定位
LogiTrack Pro 是一个物流询价与报价管理系统，用于管理从客户询价到报价反馈的完整业务流程。

### 1.2 技术栈
- **前端**: React + TypeScript + Vite
- **UI 框架**: Tailwind CSS + Lucide Icons
- **后端**: Spring Boot (Java)
- **数据库**: MySQL 8.0

### 1.3 核心业务实体

| 实体 | 说明 | 数据库表 |
|-----|------|---------|
| 询价 (Enquiry) | 客户运输方案询价请求 | `enquiry` |
| 报价 (Offer) | 针对询价的价格回复 | `offer` |
| 国家 (Country) | 国家主数据 | `country` |
| 港口 (Port) | 机场/海港主数据 | `port` |
| 销售办公室 (Sales Office) | 销售办公室字典 | `dict_sales_office` |
| 销售负责人 (Sales PIC) | 销售人员，关联国家和办公室 | `sales_pic` |
| 箱型 (Container Type) | 集装箱类型配置 | `container_types` |

---

## 2. 用户角色与权限

### 2.1 角色定义

| 角色 | 说明 | 权限范围 |
|-----|------|---------|
| **CN Pricing Admin** | 中国区定价管理员 | 创建/编辑/查询询价，管理报价 |
| **Sales User** | 销售人员（预留） | 查看自己国家的询价/报价 |
| **System Admin** | 系统管理员（预留） | 主数据维护，系统配置 |

### 2.2 权限控制点（Phase 1 简化）

- **登录验证**: 用户名密码登录
- **数据可见性**: 所有已登录用户可查看全部询价数据
- **操作权限**: 已登录用户可执行 CRUD 操作

> ⚠️ **待确认**: 是否需要细粒度权限控制（按国家/办公室过滤数据）？
答：暂不需要
---

## 3. 功能模块设计

### 3.1 登录模块

#### 3.1.1 功能描述
用户身份验证入口，验证通过后进入主系统。

#### 3.1.2 页面元素

| 元素 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| 用户名 | 文本输入 | ✅ | 默认: 登录用户名将作为 `cn_pricing_admin` |
| 密码 | 密码输入 | ✅ | 加密传输 |
| 登录按钮 | 按钮 | - | 提交验证 |
| 错误提示 | 文本 | - | 登录失败时显示 |

#### 3.1.3 业务逻辑
- 登录成功后，存储用户信息到 Session/LocalStorage
- 用户名用于后续创建询价时自动填充 `cn_pricing_admin` 字段

---

### 3.2 Dashboard 仪表盘

#### 3.2.1 功能描述
系统首页，展示关键业务指标和快捷操作入口。

#### 3.2.2 统计卡片

| 指标 | 说明 | 数据来源 |
|-----|------|---------|
| **今日新增询价** | 当天 issue_date 的询价数量 | `COUNT(enquiry WHERE issue_date = TODAY)` |
| **待报价数量** | 状态为 New 的询价 | `COUNT(enquiry WHERE status = 'New')` |
| **本月询价总数** | 当月询价数量 | `COUNT(enquiry WHERE reference_month = YYMM)` |
| **本月报价完成率** | Quoted / (New + Quoted) | 计算比例 |
| **订舱确认率** | Booking = Yes 占比 | `COUNT(booking_confirmed='Yes') / Total` |

#### 3.2.3 图表展示

1. **询价状态分布饼图**
   - New / Quoted / Cancelled 占比

2. **近30天询价趋势折线图**
   - X轴: 日期
   - Y轴: 询价数量

3. **按运输类型统计柱状图**
   - AIR / FCL / LCL / RAIL /  分布

4. **按销售国家TOP10柱状图**
   - 显示询价量最多的10个国家

#### 3.2.4 快捷操作

| 操作 | 说明 |
|-----|------|
| ➕ 新建询价 | 跳转到询价表单页 |
| 🔍 搜索询价 | 打开搜索面板 |
| 📊 导出报表 | 导出当月数据 |
| 🔄 刷新数据 | 重新加载统计数据 |

---

### 3.3 询价管理模块

#### 3.3.1 询价列表页

##### 3.3.1.1 功能描述
展示所有询价记录，支持搜索、筛选、排序、分页。

##### 3.3.1.2 列表字段

| 序号 | 字段 | 中文名 | 显示格式 | 可排序 | 可筛选 |
|-----|------|-------|---------|--------|--------|
| 1 | reference_number | 询价编号 | 文本链接 | ✅ | ✅ |
| 2 | issue_date | 创建日期 | YYYY-MM-DD | ✅ | ✅ (日期范围) |
| 3 | status | 状态 | 标签徽章 | ✅ | ✅ (下拉多选) |
| 4 | product_abbr | 产品 | 文本 | ✅ | ✅ |
| 5 | sales_country_code | 销售国家 | 国家代码 | ✅ | ✅ (下拉多选) |
| 6 | sales_pic_name | 销售负责人 | 姓名 | ✅ | ✅ |
| 7 | cargo_type_code | 运输类型 | 标签 | ✅ | ✅ (下拉多选) |
| 8 | pol_name | 起运港 | 港口名 | ✅ | ✅ |
| 9 | pod_name | 目的港 | 港口名 | ✅ | ✅ |
| 10 | booking_confirmed | 订舱确认 | 标签徽章 | ✅ | ✅ (下拉多选) |
| 11 | latest_offer_date | 最新报价日期 | YYYY-MM-DD | ✅ | ✅ |
| 12 | operations | 操作 | 按钮组 | - | - |

##### 3.3.1.3 操作按钮

| 按钮 | 图标 | 说明 | 权限 |
|-----|------|-----|------|
| 查看 | 👁️ | 查看询价详情 | 所有用户 |
| 编辑 | ✏️ | 编辑询价 | CN Admin |
| 复制 | 📋 | 复制为新询价 | CN Admin |
| 删除 | 🗑️ | 删除询价 | CN Admin |
| 添加报价 | 💰 | 快速添加报价 | CN Admin |

##### 3.3.1.4 批量操作

| 操作 | 说明 |
|-----|------|
| 批量导出 | 导出选中记录为 Excel |
| 批量更新状态 | 批量修改状态字段 |
| 批量删除 | 删除选中记录（需二次确认） |

##### 3.3.1.5 筛选面板

```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 高级筛选                                    [重置] [应用] │
├─────────────────────────────────────────────────────────────┤
│ 日期范围: [开始日期] ~ [结束日期]                            │
│ 状态:     □ New  □ Quoted  □ Cancelled                     │
│ 运输类型: □ AIR  □ FCL  □ LCL  □ RAIL  □ SEA               │
│ 销售国家: [多选下拉 ▼]                                      │
│ 销售办公室: [多选下拉 ▼]                                    │
│ 订舱确认: □ Yes  □ Rejected  □ Pending  □ Invalid          │
│ 关键词搜索: [品名/备注/要求...]                              │
└─────────────────────────────────────────────────────────────┘
```

---

#### 3.3.2 询价表单页（新建/编辑）

##### 3.3.2.1 表单布局

表单采用**分区卡片布局**，每个区域折叠可展开：

```
┌─────────────────────────────────────────────────────────────┐
│ 📋 新建询价 / 编辑询价 #CN2601001-S                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ▼ 基础信息                                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 询价编号: [自动生成，只读]    状态: [New ▼]                │ │
│ │ 收到日期: [📅 2026-01-28]    创建日期: [自动，只读]       │ │
│ │ 产品类型: [AIR-RAIL-SEA ▼]   CN定价管理员: [自动填充]      │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 销售信息 ⭐ (级联选择)                                     │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 销售国家: [FRANCE ▼]  ──────────────────┐                │ │
│ │ 销售负责人: [JOHN DOE ▼]  ──> 自动映射   │                │ │
│ │ 销售办公室: [ZIEGLER FRANCE] (只读显示) <┘                │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 货物信息                                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 运输类型: [FCL ▼]       指派CN办公室: [SHANGHAI ▼]        │ │
│ │ 体积(CBM): [  120.5 ]   数量: [  2  ] 单位: [CTN ▼]       │ │
│ │                                                          │ │
│ │ 品名: [Electronics components for automotive...]         │ │
│ │ 危险品/特设: [□ 是] [描述输入...]                         │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 箱型明细                                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ + 添加箱型                                               │ │
│ │ ┌──────────┬──────────┬──────────┐                      │ │
│ │ │ 箱型     │ 数量      │ 操作     │                      │ │
│ │ ├──────────┼──────────┼──────────┤                      │ │
│ │ │ 40HQ ▼   │   2      │  🗑️     │计算出TEU: [  3.0  ]   │ │
│ │ │ 20GP ▼   │   1      │  🗑️     │                       │ │
│ │ └──────────┴──────────┴──────────┘                      │ │
│ │ 合计 TEU: 3.0                                            │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 路线信息                                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 起运港(POL): [🔍 SHANGHAI ▼] 类型: [SEA ▼]              │ │
│ │ 目的港(POD): [🔍 LE HAVRE ▼] 类型: [SEA ▼]              │ │
│ │ 目的港国家: [FRANCE] (自动映射，只读)                     │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ▼ offer信息(可以填多个offer信息)                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                                                         │ │
│ │ ┌─────────────────────┬──────────────────┐              │ │
│ │ │ offer类型(offerType) │  [🔍 AIR ▼]     │              │ │
│ │ │ 报价次数(sequence_no)│ [  1 ]           │              │ │
│ │ │ 报价日期(quoted_on)  │ [📅 2026-01-28] │              │ │   
│ │ │ 报价(price_text)     │ [USD2.99]       │              │ │
│ │ └──────────────────────┴─────────────────┘              │ │
│ │ ┌─────────────────────┬──────────────────┐              │ │
│ │ │ offer类型(offerType) │  [🔍 AIR ▼]     │              │ │
│ │ │ 报价次数(sequence_no)│ [  2 ]           │              │ │
│ │ │ 报价日期(quoted_on)  │ [📅 2026-02-29] │               │ │   
│ │ │ 报价(price_text)     │ [USD5.99]       │               │ │
│ │ └──────────────────────┴─────────────────┘               │ │
│ └─────────────────────────────────────────────────────────┘  │
│                                                              │
│ ▼ 业务分类                                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ CORE/NON-CORE: [CORE ▼]                                 │ │
│ │ 分类: [Ocean Freight ▼]                                  │ │
│ │ 货好日期: [📅        ] 或 [TBA/Week 5/文本...]           │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 附加信息                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 附加要求: [多行文本输入...]                               │ │
│ │ 备注: [多行文本输入...]                                   │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ▼ 状态与结果 (编辑时显示)                                     │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 订舱确认: [Pending ▼]                                    │ │
│ │ 拒绝原因: [选择时显示...]                                 │ │
│ │ 实际原因: [...                                    ]      │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│                              [取消]  [保存草稿]  [提交]       │
└─────────────────────────────────────────────────────────────┘
```

##### 3.3.2.2 字段详细规格

**区块1: 基础信息**

| 字段 | 类型 | 必填 | 可编辑 | 默认值 | 验证规则 |
|-----|------|-----|--------|-------|---------|
| reference_number | 文本 | ✅ | ❌ (自动生成) | 系统生成 | 唯一性校验 |
| enquiry_received_date | 日期 | ✅ | ✅ | 当天 | 不晚于今天 |
| issue_date | 日期 | ✅ | ❌ | 当天 | 系统自动 |
| product_code | 下拉 | ✅ | ✅ | - | 必选 |
| status | 下拉 | ✅ | ✅ | New | 限定值 |
| cn_pricing_admin | 文本 | ✅ | ❌ | 登录用户 | 系统自动 |

**区块2: 销售信息（⭐ 核心级联逻辑）**

| 字段 | 类型 | 必填 | 可编辑 | 级联关系 |
|-----|------|-----|--------|---------|
| sales_country_code | 下拉 | ✅ | ✅ | 触发 PIC 列表刷新 |
| sales_pic_id | 下拉 | ✅ | ✅ | 由国家过滤；选择后自动映射 office |
| sales_office_id | 只读显示 | ✅ | ❌ | 由 sales_pic_id 自动确定 |

**级联选择逻辑**:
```
用户选择 [销售国家] → 系统过滤 [销售负责人] 列表 (仅显示该国家的PIC)
用户选择 [销售负责人] → 系统自动填充 [销售办公室] (只读)
```

**区块3: 货物信息**

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| cargo_type_code | 下拉 | ✅ | AIR/FCL/LCL/RAIL/SEA |
| assigned_cn_office_code | 下拉 | ✅ | CN办公室 |
| volume_cbm | 数字 | ❌ | 体积，可输入小数 |
| quantity | 数字 | ❌ | 数量 |
| quantity_uom_code | 下拉 | ❌ | 单位 KG/PCS/CTN/PLT/SET |
| quantity_teu | 数字 | ❌ | FCL时从箱型明细计算 |
| commodity | 多行文本 | ❌ | 品名描述 |
| haz_special_equipment | 多行文本 | ❌ | 危险品说明 |

**区块4: 箱型明细（条件显示）**

- **显示条件**: `cargo_type_code = 'FCL'`
- **子表格字段**:

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| container_type_id | 下拉 | ✅ | 选择箱型 20GP/40HQ 等 |
| container_qty | 数字 | ✅ | 箱量 ≥1 |

- **自动计算**: 汇总所有箱型的 TEU 值到 `quantity_teu`

**区块5: 路线信息**

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| pol_port_type | 下拉 | ✅ | AIR/SEA（先选类型） |
| pol_id | 搜索下拉 | ✅ | 根据类型过滤港口列表 |
| pod_port_type | 下拉 | ✅ | AIR/SEA |
| pod_id | 搜索下拉 | ✅ | 根据类型过滤 |
| pod_country_code | 只读 | ✅ | 由 pod_id 自动映射 |

**港口选择组件规格**:
- 支持**模糊搜索**（输入3字符触发）
- 显示格式: `[PORT_CODE] PORT_NAME, COUNTRY`
- 示例: `[CNSHA] Shanghai, CN` / `[FRPAR] Paris Charles de Gaulle, FR`

**区块6: 业务分类**

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| core_flag | 下拉 | ❌ | CORE/NON_CORE |
| category_code | 下拉 | ❌ | 分类字典 |
| cargo_ready_date | 日期 | ❌ | 可输入日期 |
| cargo_ready_date_raw_text | 文本 | ❌ | 或输入文本 TBA/Week 5 等 |

**区块7: 附加信息**

| 字段 | 类型 | 必填 | 最大长度 |
|-----|------|-----|---------|
| additional_requirement | 多行文本 | ❌ | 2000字符 |
| remark | 多行文本 | ❌ | 2000字符 |

**区块8: 状态与结果**

| 字段 | 类型 | 必填 | 条件显示 |
|-----|------|-----|---------|
| booking_confirmed | 下拉 | ✅ | - |
| rejected_reason | 多行文本 | ❌ | 当 booking=Rejected 时显示 |
| actual_reason | 多行文本 | ❌ | - |

---

#### 3.3.3 询价详情页

##### 3.3.3.1 页面结构

```
┌─────────────────────────────────────────────────────────────┐
│ 📋 询价详情 #CN2601001-S                    [编辑] [返回]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 状态: 🟢 Quoted    订舱: 🟡 Pending    创建: 2026-01-15    │
│                                                             │
│ ═══════════════════════════════════════════════════════════ │
│                                                             │
│ [基础信息] [货物信息] [路线信息] [报价历史] (Tab切换)        │
│                                                             │
│ ┌─ 基础信息 ──────────────────────────────────────────────┐ │
│ │ 产品类型:     SEA                                       │ │
│ │ 销售国家:     FRANCE                                    │ │
│ │ 销售负责人:   John Doe                                  │ │
│ │ 销售办公室:   ZIEGLER FRANCE (FR-ZF)                    │ │
│ │ CN定价管理员: admin                                     │ │
│ │ 指派CN办公室: Shanghai                                  │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─ 报价历史 ──────────────────────────────────────────────┐ │
│ │ ┌────┬────────────┬─────────┬──────────────────────┐    │ │
│ │ │ #  │ 发送日期   │ 类型    │ 报价                 │    │ │
│ │ ├────┼────────────┼─────────┼──────────────────────┤    │ │
│ │ │ 1  │ 2026-01-16 │ OCEAN   │ $2,500.00 ⭐(最新)   │    │ │
│ │ │ 2  │ 2026-01-18 │ OCEAN   │ $2,350.00            │    │ │
│ │ └────┴────────────┴─────────┴──────────────────────┘    │ │
│ │                                      [➕ 添加报价]      │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

---

### 3.4 报价管理模块

#### 3.4.1 添加/编辑报价弹窗

##### 3.4.1.1 弹窗内容

```
┌─────────────────────────────────────────────────────────────┐
│ 💰 添加报价                                          [✖]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 询价编号: CN2601001-S (只读)                                │
│ 运输类型: FCL (只读，决定报价类型)                          │
│                                                             │
│ ─────────────────────────────────────────────────────────── │
│                                                             │
│ 报价类型: [OCEAN ▼] (由 cargo_type 决定，可能只读)          │
│ 报价次数: #2 (自动递增)                                     │
│                                                             │
│ 发送日期: [📅 2026-01-28]                                   │
│                                                             │
│ 💵 报价金额:                                                │
│                                                             │
│   数值: [ $2,500.00 ] USD (OCEAN 时显示)                    │
│   或                                                        │
│   单价: [ $5.50 ] /KG (AIR 时显示)                          │
│                                                             │
│ 📝 报价原文:                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Ocean freight: USD 2,500 all-in                         │ │
│ │ Including BAF, CAF...                                   │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ☐ 标记为被拒报价                                            │
│                                                             │
│                                    [取消]  [保存报价]       │
└─────────────────────────────────────────────────────────────┘
```

##### 3.4.1.2 报价字段

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| offer_type | 下拉/只读 | ✅ | OCEAN/AIR/OTHER |
| sequence_no | 数字 | ✅ | 自动递增 |
| sent_date | 日期 | ❌ | 报价发送日期 |
| price | 数字 | ❌ | 数值金额 |
| price_text | 多行文本 | ❌ | 报价原文 |
| is_rejected_price | 复选框 | ❌ | 是否被拒 |

##### 3.4.1.3 业务规则

1. **报价类型唯一性**: 同一询价的所有报价必须是同一 `offer_type`
2. **最新报价标记**: 新增报价时，自动将该报价 `is_latest = 1`，其他报价置为 0
3. **状态联动**: 添加报价后，询价状态自动变为 `Quoted`

---

### 3.5 主数据管理模块

#### 3.5.1 功能入口

通过顶部导航 **[设置]** 或 **[主数据管理]** 进入。

#### 3.5.2 主数据列表

| 序号 | 主数据 | 表 | 主要操作 |
|-----|-------|---|---------|
| 1 | 国家管理 | `country` | 查看/启用/停用 |
| 2 | 港口管理 | `port` | 查看/新增/编辑/启用/停用 |
| 3 | 销售办公室管理 | `dict_sales_office` | 查看/新增/编辑 |
| 4 | 销售负责人管理 | `sales_pic` | 查看/新增/编辑 |
| 5 | 箱型管理 | `container_types` | 查看/新增/编辑 |
| 6 | 字典管理 | `dict_*` | 查看/新增/编辑 |

#### 3.5.3 国家管理页

##### 3.5.3.1 列表字段

| 字段 | 说明 |
|-----|------|
| country_code | 国家代码（2位） |
| country_name_en | 英文名 |
| country_name_cn | 中文名 |
| is_active | 启用状态 |

##### 3.5.3.2 操作
- 查看详情
- 启用/停用（软删除）
- **不支持删除**（有关联数据时）

#### 3.5.4 港口管理页

##### 3.5.4.1 列表字段

| 字段 | 说明 |
|-----|------|
| port_code | 港口代码 |
| port_name | 港口名称 |
| port_type | 类型（AIR/SEA） |
| country_code | 所属国家 |
| is_active | 启用状态 |

##### 3.5.4.2 筛选
- 按类型: AIR / SEA / ALL
- 按国家: 下拉选择
- 按状态: 启用 / 停用 / 全部

##### 3.5.4.3 新增/编辑表单

| 字段 | 类型 | 必填 |
|-----|------|-----|
| port_code | 文本 | ✅ |
| port_name | 文本 | ✅ |
| port_type | 下拉 | ✅ |
| country_code | 下拉 | ✅ |
| city | 文本 | ❌ |

#### 3.5.5 销售负责人管理页

##### 3.5.5.1 列表字段

| 字段 | 说明 |
|-----|------|
| name | 姓名 |
| country_code | 所属国家 |
| office_name | 所属办公室 |
| is_active | 启用状态 |

##### 3.5.5.2 新增/编辑表单

| 字段 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| name | 文本 | ✅ | 姓名 |
| country_code | 下拉 | ✅ | 选择国家（含AGENTS/OTHERS等） |
| sales_office_id | 下拉 | ✅ | 选择办公室 |

---

### 3.6 统计报表模块

#### 3.6.1 报表类型

| 报表 | 说明 | 导出格式 |
|-----|------|---------|
| **月度询价汇总** | 按月统计询价数量、状态分布 | Excel/PDF |
| **销售国家分析** | 按国家统计询价量、转化率 | Excel/PDF |
| **运输类型分析** | AIR/FCL/LCL/RAIL 占比 | Excel |
| **办公室业绩** | 按销售办公室统计 | Excel |
| **报价响应时效** | 从询价到报价的平均时间 | Excel |

#### 3.6.2 报表筛选条件

- 日期范围（必填）
- 销售国家（可选，多选）
- 销售办公室（可选，多选）
- 运输类型（可选，多选）
- 状态（可选，多选）

#### 3.6.3 报表展示

- **在线预览**: 表格 + 图表
- **导出下载**: Excel (.xlsx) / PDF

---

## 4. 核心交互逻辑

### 4.1 销售信息级联选择（⭐ 核心）

#### 4.1.1 流程图

```
┌───────────────────┐
│ 1. 选择销售国家    │
│   [FRANCE ▼]      │
└────────┬──────────┘
         │ 触发 API: GET /api/sales-pic?country_code=FRANCE
         ▼
┌───────────────────┐
│ 2. 加载PIC列表     │
│   - John Doe      │
│   - Jane Smith    │
│   - Marc Dupont   │
└────────┬──────────┘
         │ 用户选择 "John Doe"
         ▼
┌───────────────────┐
│ 3. 自动映射Office  │
│   sales_office_id │
│   = PIC.office_id │
└────────┬──────────┘
         │
         ▼
┌───────────────────┐
│ 4. 显示办公室名称  │
│   [ZIEGLER FRANCE]│
│   (只读)          │
└───────────────────┘
```

#### 4.1.2 前端实现要点

```typescript
// 伪代码
const handleCountryChange = async (countryCode: string) => {
  // 1. 更新国家
  setFormData({ ...formData, sales_country_code: countryCode });
  
  // 2. 清空 PIC 和 Office
  setFormData({ ...formData, sales_pic_id: null, sales_office_id: null });
  
  // 3. 加载该国家的 PIC 列表
  const picList = await api.getSalesPicByCountry(countryCode);
  setSalesPicOptions(picList);
};

const handlePicChange = (picId: number) => {
  // 1. 更新 PIC
  const selectedPic = salesPicOptions.find(p => p.id === picId);
  
  // 2. 自动设置 Office
  setFormData({
    ...formData,
    sales_pic_id: picId,
    sales_office_id: selectedPic.sales_office_id
  });
};
```

### 4.2 港口选择逻辑

#### 4.2.1 选择流程

1. 用户先选择**港口类型**（AIR/SEA）
2. 系统根据类型过滤港口列表
3. 用户通过**搜索**选择具体港口
4. 选择 POD 后，自动填充 `pod_country_code`

#### 4.2.2 港口搜索组件

```typescript
// 港口搜索 API
GET /api/ports/search?type=SEA&keyword=SHANGHAI

// 响应
[
  { id: 123, port_code: "CNSHA", port_name: "Shanghai", country_code: "CN" },
  { id: 456, port_code: "CNSHK", port_name: "Shekou", country_code: "CN" }
]
```

### 4.3 Reference Number 自动生成

#### 4.3.1 生成规则

```
格式: CN{YYMM}{SEQ}-{ABBR}{SERIAL}
示例: CN2601007-ARS1

组成:
- CN: 固定前缀
- YYMM: issue_date 年月 (2601 = 2026年01月)
- SEQ: 当月递增序号 (007)
- ABBR: 产品缩写 (ARS = AIR-RAIL-SEA)
- SERIAL: 尾号 (1, 2... 或省略)
```

#### 4.3.2 生成时机

- **新建保存时**: 后端根据 `issue_date` 和 `product_code` 自动生成
- **前端显示**: 新建时显示 "自动生成"，保存后显示实际编号

### 4.4 报价联动逻辑

| 触发动作 | 联动效果 |
|---------|---------|
| 新增报价 | `enquiry.status` → `Quoted` |
| 新增报价 | 新报价 `is_latest=1`，历史报价 `is_latest=0` |
| 删除所有报价 | `enquiry.status` 可回退到 `New` |

---

## 5. 字段级详细设计

### 5.1 下拉字典映射

| 字段 | 数据来源 | 显示格式 |
|-----|---------|---------|
| product_code | `dict_product` | `{name}` |
| status | 枚举 | `New/Quoted/Cancelled` |
| cargo_type_code | `dict_cargo_type` | `{name}` |
| assigned_cn_office_code | `dict_cn_office` | `{name}` |
| quantity_uom_code | `dict_uom` | `{code} - {name}` |
| category_code | `dict_category` | `{name}` |
| core_flag | 枚举 | `CORE/NON_CORE` |
| booking_confirmed | 枚举 | `Yes/Rejected/Pending/Invalid` |

### 5.2 特殊字段处理

#### 5.2.1 sales_country_code 特殊值

| 值 | 说明 |
|---|------|
| 标准ISO代码 | 如 FR, DE, CN |
| AGENTS | 代理商 |
| OTHERS | 其他 |
| TBA | 待定 |

#### 5.2.2 货好日期双模式

- **日期模式**: 选择具体日期 → 存入 `cargo_ready_date`
- **文本模式**: 输入 "TBA" / "Week 5" / "End of Feb" → 存入 `cargo_ready_date_raw_text`

前端提供切换按钮: `[📅 日期] [📝 文本]`

---

## 6. API 接口需求

### 6.1 询价相关

| 接口 | 方法 | 路径 | 说明 |
|-----|------|-----|------|
| 查询列表 | GET | `/api/enquiries` | 支持分页、筛选、排序 |
| 查询详情 | GET | `/api/enquiries/{id}` | 包含报价历史 |
| 新建 | POST | `/api/enquiries` | 返回含 reference_number |
| 更新 | PUT | `/api/enquiries/{id}` | - |
| 删除 | DELETE | `/api/enquiries/{id}` | - |
| 批量导出 | POST | `/api/enquiries/export` | Excel |

### 6.2 报价相关

| 接口 | 方法 | 路径 | 说明 |
|-----|------|-----|------|
| 查询报价 | GET | `/api/enquiries/{id}/offers` | 某询价的报价列表 |
| 添加报价 | POST | `/api/enquiries/{id}/offers` | - |
| 更新报价 | PUT | `/api/offers/{id}` | - |
| 删除报价 | DELETE | `/api/offers/{id}` | - |

### 6.3 主数据相关

| 接口 | 方法 | 路径 | 说明 |
|-----|------|-----|------|
| 国家列表 | GET | `/api/countries` | - |
| 港口搜索 | GET | `/api/ports/search?type=&keyword=` | 支持模糊搜索 |
| 销售办公室列表 | GET | `/api/sales-offices` | - |
| 销售PIC列表 | GET | `/api/sales-pic?country_code=` | ⭐ 按国家过滤 |
| 箱型列表 | GET | `/api/container-types` | - |
| 字典数据 | GET | `/api/dict/{type}` | 统一字典接口 |

### 6.4 统计相关

| 接口 | 方法 | 路径 | 说明 |
|-----|------|-----|------|
| Dashboard统计 | GET | `/api/statistics/dashboard` | 仪表盘数据 |
| 月度报表 | GET | `/api/statistics/monthly?year=&month=` | - |
| 导出报表 | POST | `/api/statistics/export` | - |

---

## 7. UI/UX 设计原则

### 7.1 设计规范

| 项目 | 规范 |
|-----|------|
| **主色调** | 蓝色系 #3B82F6 (Blue-500) |
| **字体** | Inter / 思源黑体 |
| **间距** | 8px 网格系统 |
| **圆角** | 按钮 4px，卡片 8px |
| **阴影** | 卡片使用 shadow-md |

### 7.2 状态徽章样式

| 状态 | 颜色 | 样式 |
|-----|------|-----|
| New | 蓝色 | `bg-blue-100 text-blue-800` |
| Quoted | 绿色 | `bg-green-100 text-green-800` |
| Cancelled | 灰色 | `bg-gray-100 text-gray-800` |
| Pending | 黄色 | `bg-yellow-100 text-yellow-800` |
| Yes | 绿色 | `bg-green-100 text-green-800` |
| Rejected | 红色 | `bg-red-100 text-red-800` |

### 7.3 响应式断点

| 断点 | 宽度 | 布局 |
|-----|------|-----|
| sm | ≥640px | 单列 |
| md | ≥768px | 双列表单 |
| lg | ≥1024px | 侧边栏 + 内容 |
| xl | ≥1280px | 完整布局 |

### 7.4 加载与空状态

- **加载中**: 骨架屏 + Spinner
- **空数据**: 插图 + 提示文字 + 操作按钮
- **错误**: Toast 提示 + 重试按钮

---

## 8. 待确认事项

### 8.1 功能相关

| 编号 | 问题 | 选项 | 状态 |
|-----|------|-----|------|
| Q1 | 是否需要用户权限管理功能？ | A: 简化版(仅登录) / B: 完整RBAC | ⏳ 待确认 |
| Q2 | 询价删除是物理删除还是软删除？ | A: 物理删除 / B: 软删除 | ⏳ 待确认 |
| Q3 | 是否需要操作日志/审计功能？ | A: 需要 / B: 不需要 | ⏳ 待确认 |
| Q4 | 报表导出是否需要权限控制？ | A: 是 / B: 否 | ⏳ 待确认 |
| Q5 | 是否需要数据导入功能(Excel导入)？ | A: 是 / B: 否 | ⏳ 待确认 |

### 8.2 UI/UX 相关

| 编号 | 问题 | 选项 | 状态 |
|-----|------|-----|------|
| Q6 | 列表默认排序方式？ | A: 创建时间倒序 / B: 更新时间倒序 | ⏳ 待确认 |
| Q7 | 每页默认显示条数？ | A: 20 / B: 50 / C: 100 | ⏳ 待确认 |
| Q8 | 是否需要深色模式？ | A: 是 / B: 否 | ⏳ 待确认 |
| Q9 | 语言支持？ | A: 仅英文 / B: 中英双语 | ⏳ 待确认 |

### 8.3 技术相关

| 编号 | 问题 | 选项 | 状态 |
|-----|------|-----|------|
| Q10 | 状态管理方案？ | A: React Context / B: Zustand / C: Redux | ⏳ 待确认 |
| Q11 | UI组件库选择？ | A: 自定义Tailwind / B: Shadcn/ui / C: Ant Design | ⏳ 待确认 |
| Q12 | 表格组件选择？ | A: 自定义 / B: TanStack Table / C: AG Grid | ⏳ 待确认 |

---

## 文档修订记录

| 版本 | 日期 | 作者 | 修订内容 |
|-----|------|-----|---------|
| v1.0 | 2026-01-28 | System | 初稿，基于 schema_v2.sql 设计 |

---

**请审核以上功能需求，确认或提出修改意见。** 🙏
